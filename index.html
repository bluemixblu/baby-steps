<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- ç·©å­˜æ§åˆ¶ï¼šç¢ºä¿ç”¨æˆ¶ç²å–æœ€æ–°ç‰ˆæœ¬ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- ç‰ˆæœ¬è™Ÿï¼šV19.0 - 2025-11-29 -->
    <title>å°ä¸€å­¸ç¿’æ¨‚åœ’ V19.0</title>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: "Microsoft JhengHei", "DFKai-SB", sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0; 
            min-height: 100vh;
            user-select: none;
        }
        
        /* ===== é¦–é é¸å–® ===== */
        .home-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .home-title {
            color: white;
            font-size: 48px;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }
        .home-subtitle {
            color: rgba(255,255,255,0.8);
            font-size: 20px;
            margin-bottom: 40px;
        }
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            max-width: 1000px;
            width: 100%;
        }
        .menu-card {
            background: white;
            border-radius: 25px;
            padding: 40px 30px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .menu-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .menu-card-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        .menu-card-title {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .menu-card-desc {
            font-size: 16px;
            color: #666;
        }
        .menu-card.chinese { border-top: 5px solid #e91e63; }
        .menu-card.english { border-top: 5px solid #2196f3; }
        .menu-card.math { border-top: 5px solid #4caf50; }
        
        .version-tag {
            position: fixed;
            bottom: 10px;
            right: 10px;
            color: rgba(255,255,255,0.5);
            font-size: 12px;
        }
        
        /* ===== é€šç”¨æ¨¡çµ„å®¹å™¨ ===== */
        .module-container {
            display: none;
            min-height: 100vh;
            background: #f4f7f6;
            flex-direction: column;
        }
        .module-container.active {
            display: flex;
        }
        
        /* ===== é ‚éƒ¨å°èˆª ===== */
        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: #2c3e50;
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
            margin-right: 15px;
        }
        .nav-title {
            color: white;
            font-size: 20px;
            font-weight: bold;
        }
        
        /* ===== åœ‹å­—æ¨¡çµ„ ===== */
        .chinese-module {
            margin-top: 60px;
            width: 100%;
            display: flex;
            height: calc(100vh - 60px);
            flex: 1;
        }
        .sidebar { width: 260px; min-width: 260px; background: #2c3e50; color: white; display: flex; flex-direction: column; overflow-y: auto; z-index: 90; transition: 0.3s; height: calc(100vh - 60px); flex-shrink: 0; }
        .sidebar-title { padding: 20px; font-size: 20px; font-weight: bold; background: #1a252f; text-align: center; flex-shrink: 0; border-bottom: 1px solid #34495e;}
        .lesson-header { width: 100%; padding: 15px 20px; border: none; background: none; color: #ecf0f1; text-align: left; font-size: 18px; cursor: pointer; border-bottom: 1px solid #34495e; }
        .word-grid { display: none; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 10px; background: #233140; }
        .word-grid.show { display: grid; }
        .sidebar-word-btn { background: #34495e; color: #fff; border: 1px solid #4a6278; border-radius: 5px; padding: 8px 0; cursor: pointer; font-size: 16px; }
        .sidebar-word-btn.current { background: #f1c40f; color: #2c3e50; font-weight: bold; border-color: #f39c12; }
        .overlay { position: fixed; top: 60px; left: 0; width: 100%; height: calc(100% - 60px); background: rgba(0,0,0,0.5); z-index: 80; display: none; }
        .overlay.active { display: block; }
        .main-content { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; padding: 20px; overflow-y: auto; }
        .current-lesson-info { font-size: 24px; color: #555; font-weight: bold; margin-bottom: 20px; }
        .nav-btn { position: absolute; top: 50%; transform: translateY(-50%); width: 50px; height: 50px; background: rgba(255,255,255,0.9); border: 2px solid #ddd; border-radius: 50%; font-size: 24px; color: #555; cursor: pointer; z-index: 15; }
        .prev-btn { left: 10px; } .next-btn { right: 10px; }
        .card-container { background: #fff; padding: 20px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); display: flex; flex-direction: column; align-items: center; max-width: 95%; }
        .character-wrapper { display: flex; margin-bottom: 15px; gap: 10px; }
        #character-target-div { border: 3px solid #333; background: #fffadd; border-radius: 8px; position: relative; }
        #character-target-div::before { content: ""; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: #d47e7e; pointer-events: none; }
        #character-target-div::after { content: ""; position: absolute; left: 50%; top: 0; height: 100%; width: 1px; background: #d47e7e; pointer-events: none; }
        .zhuyin-system { display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; color: #333; }
		.zhuyin-light-tone { font-size: 48px; height: 50px; line-height: 50px; visibility: hidden; text-align: center; }
		.zhuyin-body-row { display: flex; flex-direction: row; align-items: center; }
		.zhuyin-symbols { font-size: 40px; writing-mode: vertical-rl; text-orientation: upright; letter-spacing: 8px; }
		.zhuyin-side-tone { font-size: 56px; display: flex; align-items: center; justify-content: center; margin-left: 3px; }
        .controls { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; justify-content: center; }
        .btn { padding: 10px 20px; font-size: 16px; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 3px 5px rgba(0,0,0,0.1); }
        .btn-speak { background: #FFB74D; color: white; }
        .btn-animate { background: #4FC3F7; color: white; }
        .btn-quiz { background: #66BB6A; color: white; }
        .btn-test { background: linear-gradient(135deg, #9C27B0, #E91E63); color: white; }
        .error-message { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: red; font-weight: bold; font-size: 20px; background: rgba(255,255,255,0.9); padding: 10px; display: none; text-align: center;}
        
        .menu-toggle-btn { position: fixed; top: 70px; left: 15px; z-index: 100; background: #2c3e50; color: white; border: none; border-radius: 5px; padding: 10px 15px; font-size: 18px; cursor: pointer; display: none; }
        
        @media (max-width: 768px) { 
            .menu-toggle-btn { display: block; } 
            .sidebar { position: fixed; top: 60px; left: 0; height: calc(100% - 60px); transform: translateX(-100%); z-index: 95; } 
            .sidebar.active { transform: translateX(0); } 
            .nav-btn { display: none; } 
            .current-lesson-info { font-size: 18px; } 
            .btn { padding: 8px 15px; font-size: 14px; }
            .home-title { font-size: 32px; }
            .menu-card { padding: 30px 20px; }
            .menu-card-icon { font-size: 60px; }
            .menu-card-title { font-size: 22px; }
        }
        
        /* ===== åœ‹å­—å°æ¸¬é©— ===== */
        .quiz-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; display: none; align-items: center; justify-content: center; }
        .quiz-modal.active { display: flex; }
        .quiz-setup-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px 40px; border-radius: 20px; text-align: center; color: white; box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 400px; width: 90%; }
        .quiz-setup-box h2 { margin: 0 0 25px 0; font-size: 28px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .quiz-setup-box label { display: block; margin-bottom: 8px; font-size: 18px; }
        .quiz-input-row { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 25px; }
        .quiz-input { width: 60px; padding: 12px; font-size: 24px; text-align: center; border: none; border-radius: 10px; background: rgba(255,255,255,0.9); color: #333; font-weight: bold; }
        .quiz-input:focus { outline: 3px solid #f1c40f; }
        .quiz-separator { font-size: 28px; font-weight: bold; }
        .quiz-btn-row { display: flex; gap: 15px; justify-content: center; }
        .quiz-start-btn { background: #f1c40f; color: #333; border: none; padding: 15px 40px; font-size: 20px; font-weight: bold; border-radius: 50px; cursor: pointer; }
        .quiz-cancel-btn { background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 15px 30px; font-size: 18px; font-weight: bold; border-radius: 50px; cursor: pointer; }
        
        .quiz-game-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); z-index: 1001; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .quiz-game-container.active { display: flex; }
        .quiz-header { position: absolute; top: 20px; width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; box-sizing: border-box; }
        .quiz-progress { color: #f1c40f; font-size: 24px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .quiz-exit-btn { background: rgba(255,255,255,0.1); color: white; border: 2px solid rgba(255,255,255,0.3); padding: 10px 20px; font-size: 16px; border-radius: 25px; cursor: pointer; }
        .quiz-card { background: white; padding: 30px; border-radius: 25px; box-shadow: 0 20px 60px rgba(0,0,0,0.4); display: flex; flex-direction: column; align-items: center; }
        .quiz-zhuyin-display { margin-bottom: 20px; }
        .quiz-zhuyin-large { font-size: 60px; writing-mode: vertical-rl; text-orientation: upright; letter-spacing: 10px; color: #333; font-weight: bold; }
        .quiz-tone-light { font-size: 40px; text-align: center; margin-bottom: 5px; }
        .quiz-tone-side { font-size: 48px; margin-left: 5px; }
        #quiz-writer-div { border: 4px solid #333; background: linear-gradient(135deg, #fffadd, #fff5cc); border-radius: 12px; position: relative; }
        #quiz-writer-div::before { content: ""; position: absolute; top: 50%; left: 0; width: 100%; height: 2px; background: rgba(212,126,126,0.5); pointer-events: none; }
        #quiz-writer-div::after { content: ""; position: absolute; left: 50%; top: 0; height: 100%; width: 2px; background: rgba(212,126,126,0.5); pointer-events: none; }
        .quiz-hint-text { margin-top: 15px; color: #888; font-size: 16px; }
        
        .quiz-success-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1002; display: none; align-items: center; justify-content: center; flex-direction: column; }
        .quiz-success-overlay.active { display: flex; }
        .success-emoji { font-size: 120px; animation: bounce 0.6s ease-in-out infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-30px); } }
        .success-text { color: #f1c40f; font-size: 48px; font-weight: bold; margin-top: 20px; text-shadow: 3px 3px 6px rgba(0,0,0,0.5); }
        .success-subtext { color: white; font-size: 24px; margin-top: 10px; }
        .success-btn { margin-top: 30px; background: #f1c40f; color: #333; border: none; padding: 15px 50px; font-size: 22px; font-weight: bold; border-radius: 50px; cursor: pointer; }
        
        /* ===== ESLè‹±æ–‡æ¨¡çµ„ ===== */
        .esl-module {
            margin-top: 60px;
            width: 100%;
            height: calc(100vh - 60px);
            display: flex;
            flex-direction: row;
            flex: 1;
        }
        .esl-sidebar {
            width: 250px;
            min-width: 250px;
            background: #1565c0;
            color: white;
            height: calc(100vh - 60px);
            overflow-y: auto;
            flex-shrink: 0;
        }
        .esl-sidebar-title {
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
            background: #0d47a1;
            text-align: center;
        }
        .esl-lesson-btn {
            width: 100%;
            padding: 15px 20px;
            border: none;
            background: none;
            color: white;
            text-align: left;
            font-size: 16px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .esl-lesson-btn:hover, .esl-lesson-btn.active {
            background: rgba(255,255,255,0.1);
        }
        .esl-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            overflow-y: auto;
        }
        .esl-card {
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }
        .esl-word {
            font-size: 36px;
            font-weight: bold;
            color: #1565c0;
            margin-bottom: 20px;
            min-height: 50px;
        }
        .esl-progress {
            color: #666;
            margin-bottom: 20px;
        }
        .esl-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .esl-btn {
            padding: 12px 25px;
            font-size: 16px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
        }
        .esl-btn-speak { background: #ff9800; color: white; }
        .esl-btn-prev { background: #9e9e9e; color: white; }
        .esl-btn-next { background: #2196f3; color: white; }
        .esl-btn-quiz { background: linear-gradient(135deg, #9C27B0, #E91E63); color: white; }
        
        .esl-quiz-container {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #1565c0, #0d47a1);
            z-index: 1001;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .esl-quiz-container.active { display: flex; }
        .esl-quiz-card {
            background: white;
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            max-width: 500px;
            width: 100%;
        }
        .esl-quiz-question {
            font-size: 28px;
            margin-bottom: 30px;
            color: #333;
        }
        .esl-quiz-input {
            width: 100%;
            padding: 15px;
            font-size: 24px;
            border: 3px solid #ddd;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }
        .esl-quiz-input:focus {
            outline: none;
            border-color: #2196f3;
        }
        .esl-quiz-input.correct {
            border-color: #4caf50;
            background: #e8f5e9;
        }
        .esl-quiz-input.wrong {
            border-color: #f44336;
            background: #ffebee;
        }
        .esl-quiz-feedback {
            font-size: 20px;
            margin-bottom: 20px;
            min-height: 30px;
        }
        
        @media (max-width: 768px) {
            .esl-sidebar {
                position: fixed;
                top: 60px;
                left: 0;
                height: calc(100% - 60px);
                transform: translateX(-100%);
                z-index: 95;
            }
            .esl-sidebar.active {
                transform: translateX(0);
            }
        }
        
        /* ===== 99ä¹˜æ³•è¡¨æ¨¡çµ„ ===== */
        .math-module {
            padding-top: 80px;
            width: 100%;
            min-height: calc(100vh - 60px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            padding-bottom: 40px;
        }
        .math-mode-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .math-mode-btn {
            padding: 15px 30px;
            font-size: 18px;
            border: 3px solid #4caf50;
            background: white;
            color: #4caf50;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        .math-mode-btn.active, .math-mode-btn:hover {
            background: #4caf50;
            color: white;
        }
        .math-card {
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 600px;
            width: 100%;
        }
        .math-table {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }
        .math-table-cell {
            padding: 8px 4px;
            background: #e8f5e9;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
        }
        .math-table-cell.header {
            background: #4caf50;
            color: white;
        }
        .math-question {
            font-size: 48px;
            font-weight: bold;
            color: #333;
            margin: 30px 0;
        }
        .math-input {
            width: 120px;
            padding: 15px;
            font-size: 36px;
            border: 3px solid #ddd;
            border-radius: 15px;
            text-align: center;
        }
        .math-input:focus {
            outline: none;
            border-color: #4caf50;
        }
        .math-input.correct {
            border-color: #4caf50;
            background: #e8f5e9;
        }
        .math-input.wrong {
            border-color: #f44336;
            background: #ffebee;
        }
        .math-feedback {
            font-size: 24px;
            margin: 20px 0;
            min-height: 36px;
        }
        .math-score {
            font-size: 20px;
            color: #666;
        }
        .math-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        .math-btn {
            padding: 12px 30px;
            font-size: 18px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
        }
        .math-btn-next { background: #4caf50; color: white; }
        .math-btn-quiz { background: linear-gradient(135deg, #9C27B0, #E91E63); color: white; }
    </style>
</head>
<body>
    <!-- ===== é¦–é é¸å–® ===== -->
    <div class="home-container" id="home-page">
        <div class="home-title">ğŸ“ å°ä¸€å­¸ç¿’æ¨‚åœ’</div>
        <div class="home-subtitle">é¸æ“‡ä½ æƒ³è¦ç·´ç¿’çš„é …ç›®</div>
        <div class="menu-grid">
            <div class="menu-card chinese" onclick="showModule('chinese')">
                <div class="menu-card-icon">âœï¸</div>
                <div class="menu-card-title">åœ‹å­—ç­†é †ç·´ç¿’</div>
                <div class="menu-card-desc">åº·è»’å°ä¸€åœ‹å­—ç­†é †å­¸ç¿’</div>
            </div>
            <div class="menu-card english" onclick="showModule('esl')">
                <div class="menu-card-icon">ğŸ”¤</div>
                <div class="menu-card-title">ESL è‹±æ–‡ç·´ç¿’</div>
                <div class="menu-card-desc">è‹±æ–‡å–®å­—èˆ‡ç‰‡èªå­¸ç¿’</div>
            </div>
            <div class="menu-card math" onclick="showModule('math')">
                <div class="menu-card-icon">ğŸ”¢</div>
                <div class="menu-card-title">99 ä¹˜æ³•è¡¨</div>
                <div class="menu-card-desc">ä¹˜æ³•è¡¨è¤‡ç¿’èˆ‡æ¸¬é©—</div>
            </div>
        </div>
        <div class="version-tag">V19.0</div>
    </div>
    
    <!-- ===== åœ‹å­—æ¨¡çµ„ ===== -->
    <div class="module-container" id="chinese-module">
        <div class="top-nav">
            <button class="back-btn" onclick="showHome()">â†</button>
            <div class="nav-title">âœï¸ åœ‹å­—ç­†é †ç·´ç¿’</div>
        </div>
        <button class="menu-toggle-btn" id="menu-toggle">â˜° é¸æ“‡èª²ç¨‹</button>
    <div class="overlay" id="overlay"></div>
        <div class="chinese-module">
            <div class="sidebar" id="sidebar"><div class="sidebar-title">åº·è»’å°ä¸€èª²ç¨‹</div></div>
            <div class="main-content">
        <div class="current-lesson-info" id="lesson-title"></div>
                <button class="nav-btn prev-btn" id="btn-prev">â—€</button>
                <button class="nav-btn next-btn" id="btn-next">â–¶</button>
        <div class="card-container">
            <div class="character-wrapper">
                        <div id="character-target-div"><div id="error-msg" class="error-message">è¼‰å…¥å¤±æ•—</div></div>
                <div class="zhuyin-system" id="zhuyin-box">
                            <div class="zhuyin-light-tone" id="tone-light">Ë™</div>
                    <div class="zhuyin-body-row"><div class="zhuyin-symbols" id="zhuyin-symbols"></div><div class="zhuyin-side-tone" id="tone-side"></div></div>
                        </div>
                    </div>
                    <div class="controls">
                        <button id="speak-button" class="btn btn-speak">ğŸ”Š è½ç™¼éŸ³</button>
                        <button id="animate-button" class="btn btn-animate">âœï¸ ç­†é †å‹•ç•«</button>
                        <button id="quiz-button" class="btn btn-quiz">ğŸ“ ç·´ç¿’æ›¸å¯«</button>
                        <button id="test-button" class="btn btn-test">ğŸ¯ å°æ¸¬é©—</button>
                    </div>
                    <div class="progress-indicator" id="progress-text"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- åœ‹å­—å°æ¸¬é©—å½ˆçª— -->
    <div class="quiz-modal" id="quiz-modal">
        <div class="quiz-setup-box">
            <h2>ğŸ¯ å°æ¸¬é©—</h2>
            <label>è«‹è¼¸å…¥èª²ç¨‹ç¯„åœ</label>
            <div class="quiz-input-row">
                <span>ç¬¬</span>
                <input type="number" id="quiz-start-lesson" class="quiz-input" value="1" min="1" max="6">
                <span class="quiz-separator">~</span>
                <input type="number" id="quiz-end-lesson" class="quiz-input" value="3" min="1" max="6">
                <span>èª²</span>
            </div>
            <div class="quiz-btn-row">
                <button class="quiz-cancel-btn" id="quiz-cancel-btn">å–æ¶ˆ</button>
                <button class="quiz-start-btn" id="quiz-start-btn">é–‹å§‹æ¸¬é©— ğŸš€</button>
            </div>
        </div>
    </div>
    
    <div class="quiz-game-container" id="quiz-game-container">
        <div class="quiz-header">
            <div class="quiz-progress" id="quiz-game-progress">1 / 5</div>
            <button class="quiz-exit-btn" id="quiz-exit-btn">âœ– çµæŸ</button>
        </div>
        <div class="quiz-card">
            <div class="quiz-zhuyin-display">
                <div class="quiz-tone-light" id="quiz-tone-light"></div>
                <div style="display: flex; align-items: center;">
                    <div class="quiz-zhuyin-large" id="quiz-zhuyin-symbols"></div>
                    <div class="quiz-tone-side" id="quiz-tone-side"></div>
                </div>
            </div>
            <div id="quiz-writer-div"></div>
            <div class="quiz-hint-text">è«‹å¯«å‡ºé€™å€‹æ³¨éŸ³å°æ‡‰çš„åœ‹å­—</div>
        </div>
    </div>
    
    <div class="quiz-success-overlay" id="quiz-success-overlay">
        <div class="success-emoji">ğŸ‰</div>
        <div class="success-text">æ­å–œéé—œï¼</div>
        <div class="success-subtext" id="success-subtext">å…¨éƒ¨ 5 é¡Œéƒ½ç­”å°äº†ï¼</div>
        <button class="success-btn" id="success-close-btn">å¤ªæ£’äº†ï¼ ğŸ‘</button>
    </div>
    
    <!-- ===== ESLè‹±æ–‡æ¨¡çµ„ ===== -->
    <div class="module-container" id="esl-module">
        <div class="top-nav">
            <button class="back-btn" onclick="showHome()">â†</button>
            <div class="nav-title">ğŸ”¤ ESL è‹±æ–‡ç·´ç¿’</div>
        </div>
        <button class="menu-toggle-btn" id="esl-menu-toggle" onclick="toggleEslSidebar()">â˜° é¸æ“‡èª²ç¨‹</button>
        <div class="overlay" id="esl-overlay" onclick="toggleEslSidebar()"></div>
        <div class="esl-module">
            <div class="esl-sidebar" id="esl-sidebar">
                <div class="esl-sidebar-title">ESL èª²ç¨‹</div>
                <!-- å‹•æ…‹ç”Ÿæˆ -->
            </div>
            <div class="esl-main">
                <div class="esl-card">
                    <div class="esl-progress" id="esl-progress">Lesson 1 - 1/5</div>
                    <div class="esl-word" id="esl-word">homework</div>
                    <div class="esl-controls">
                        <button class="esl-btn esl-btn-speak" onclick="speakEnglish()">ğŸ”Š è½ç™¼éŸ³</button>
                        <button class="esl-btn esl-btn-prev" onclick="eslPrev()">â—€ ä¸Šä¸€å€‹</button>
                        <button class="esl-btn esl-btn-next" onclick="eslNext()">ä¸‹ä¸€å€‹ â–¶</button>
                        <button class="esl-btn esl-btn-quiz" onclick="startEslQuiz()">ğŸ¯ å°æ¸¬é©—</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ESL æ¸¬é©— -->
    <div class="esl-quiz-container" id="esl-quiz-container">
        <div class="quiz-header">
            <div class="quiz-progress" id="esl-quiz-progress">1 / 5</div>
            <button class="quiz-exit-btn" onclick="endEslQuiz()">âœ– çµæŸ</button>
        </div>
        <div class="esl-quiz-card">
            <div class="esl-quiz-question" id="esl-quiz-question">ğŸ”Š è«‹è½ç™¼éŸ³ï¼Œè¼¸å…¥æ­£ç¢ºçš„å–®å­—</div>
            <button class="esl-btn esl-btn-speak" onclick="speakQuizWord()" style="margin-bottom:20px;">ğŸ”Š å†è½ä¸€æ¬¡</button>
            <input type="text" class="esl-quiz-input" id="esl-quiz-input" placeholder="è¼¸å…¥ç­”æ¡ˆ..." autocomplete="off">
            <div class="esl-quiz-feedback" id="esl-quiz-feedback"></div>
            <button class="esl-btn esl-btn-next" onclick="checkEslAnswer()">ç¢ºèªç­”æ¡ˆ âœ“</button>
        </div>
    </div>
    
    <!-- ===== 99ä¹˜æ³•è¡¨æ¨¡çµ„ ===== -->
    <div class="module-container" id="math-module">
        <div class="top-nav">
            <button class="back-btn" onclick="showHome()">â†</button>
            <div class="nav-title">ğŸ”¢ 99 ä¹˜æ³•è¡¨</div>
        </div>
        <div class="math-module">
            <div class="math-mode-selector">
                <button class="math-mode-btn active" onclick="setMathMode('table')">ğŸ“‹ è¤‡ç¿’è¡¨æ ¼</button>
                <button class="math-mode-btn" onclick="setMathMode('practice')">âœï¸ ç·´ç¿’é¡Œç›®</button>
                <button class="math-mode-btn" onclick="setMathMode('quiz')">ğŸ¯ å°æ¸¬é©—</button>
            </div>
            <div class="math-card" id="math-card">
                <!-- å‹•æ…‹å…§å®¹ -->
            </div>
        </div>
    </div>

    <script>
        // ===== æ¨¡çµ„åˆ‡æ› =====
        function showHome() {
            document.getElementById('home-page').style.display = 'flex';
            document.querySelectorAll('.module-container').forEach(m => m.classList.remove('active'));
        }
        
        function showModule(module) {
            document.getElementById('home-page').style.display = 'none';
            document.querySelectorAll('.module-container').forEach(m => m.classList.remove('active'));
            document.getElementById(module + '-module').classList.add('active');
            
            if (module === 'chinese') {
                initChineseModule();
            } else if (module === 'esl') {
                initEslModule();
            } else if (module === 'math') {
                initMathModule();
            }
        }
        
        // ===== åœ‹å­—æ¨¡çµ„ =====
        const chineseLessons = [
            { title: "ç¬¬ä¸€èª² æ‹æ‹æ‰‹", words: [
                {char: "æ‹", zhuyin: "ã„†ã„"}, {char: "æ‰‹", zhuyin: "ã„•ã„¡Ë‡"}, 
                {char: "å·¦", zhuyin: "ã„—ã„¨ã„›Ë‡"}, {char: "å³", zhuyin: "ã„§ã„¡Ë‹"}, 
                {char: "ä½ ", zhuyin: "ã„‹ã„§Ë‡"}, {char: "ä»–", zhuyin: "ã„Šã„š"}, 
                {char: "ä¹Ÿ", zhuyin: "ã„§ã„Ë‡"}, {char: "ä¸Š", zhuyin: "ã„•ã„¤Ë‹"}, 
                {char: "ä¸‹", zhuyin: "ã„’ã„§ã„šË‹"}
            ]},
            { title: "ç¬¬äºŒèª² é€™æ˜¯èª°çš„?", words: [
                {char: "é€™", zhuyin: "ã„“ã„œË‹"}, {char: "æ˜¯", zhuyin: "ã„•Ë‹"}, 
                {char: "èª°", zhuyin: "ã„•ã„ŸËŠ"}, {char: "çš„", zhuyin: "Ë™ã„‰ã„œ"}, 
                {char: "æˆ‘", zhuyin: "ã„¨ã„›Ë‡"}, {char: "åˆ†", zhuyin: "ã„ˆã„£"}, 
                {char: "å¥½", zhuyin: "ã„ã„ Ë‡"}, {char: "äº†", zhuyin: "Ë™ã„Œã„œ"}, 
                {char: "å•Š", zhuyin: "Ë™ã„š"}, {char: "å¤š", zhuyin: "ã„‰ã„¨ã„›"}, 
                {char: "å€‹", zhuyin: "Ë™ã„ã„œ"}
            ]},
            { title: "ç¬¬ä¸‰èª² ç§‹åƒ", words: [
                {char: "ç§‹", zhuyin: "ã„‘ã„§ã„¡"}, {char: "åƒ", zhuyin: "ã„‘ã„§ã„¢"}, 
                {char: "å’Œ", zhuyin: "ã„ã„¢Ë‹"}, {char: "ç©", zhuyin: "ã„¨ã„¢ËŠ"}, 
                {char: "é™ª", zhuyin: "ã„†ã„ŸËŠ"}, {char: "é«˜", zhuyin: "ã„ã„ "}, 
                {char: "å±±", zhuyin: "ã„•ã„¢"}, {char: "åˆ°", zhuyin: "ã„‰ã„ Ë‹"}, 
                {char: "å¤§", zhuyin: "ã„‰ã„šË‹"}, {char: "æµ·", zhuyin: "ã„ã„Ë‡"}, 
                {char: "æœ‹", zhuyin: "ã„†ã„¥ËŠ"}, {char: "å‹", zhuyin: "ã„§ã„¡Ë‡"}, 
                {char: "å€‘", zhuyin: "Ë™ã„‡ã„£"}, {char: "èµ·", zhuyin: "ã„‘ã„§Ë‡"}
            ]},
            { title: "ç¬¬å››èª² å¤§å€‹å­ï¼Œå°å€‹å­", words: [
                {char: "å­", zhuyin: "Ë™ã„—"}, {char: "å°", zhuyin: "ã„’ã„§ã„ Ë‡"}, 
                {char: "èª²", zhuyin: "ã„ã„œË‹"}, {char: "å…©", zhuyin: "ã„Œã„§ã„¤Ë‡"}, 
                {char: "äºº", zhuyin: "ã„–ã„£ËŠ"}, {char: "æ‹‰", zhuyin: "ã„Œã„š"}, 
                {char: "çœ‹", zhuyin: "ã„ã„¢Ë‹"}, {char: "æ‰¾", zhuyin: "ã„“ã„ Ë‡"}, 
                {char: "éš»", zhuyin: "ã„“"}, {char: "é’", zhuyin: "ã„‘ã„§ã„¥"}, 
                {char: "è›™", zhuyin: "ã„¨ã„š"}, {char: "é–‹", zhuyin: "ã„ã„"}, 
                {char: "å¿ƒ", zhuyin: "ã„’ã„§ã„£"}
            ]},
            { title: "ç¬¬äº”èª² æ¯”ä¸€æ¯”", words: [
                {char: "æ¯”", zhuyin: "ã„…ã„§Ë‡"}, {char: "é–€", zhuyin: "ã„‡ã„£ËŠ"}, 
                {char: "è£¡", zhuyin: "ã„Œã„§Ë‡"}, {char: "å¤–", zhuyin: "ã„¨ã„Ë‹"}, 
                {char: "æœ‰", zhuyin: "ã„§ã„¡Ë‡"}, {char: "ä»€", zhuyin: "ã„•ã„œËŠ"}, 
                {char: "éº¼", zhuyin: "Ë™ã„‡ã„œ"}, {char: "ä¸", zhuyin: "ã„…ã„¨Ë‹"}, 
                {char: "åŒ", zhuyin: "ã„Šã„¨ã„¥ËŠ"}, {char: "æ—©", zhuyin: "ã„—ã„ Ë‡"}, 
                {char: "æ™š", zhuyin: "ã„¨ã„¢Ë‡"}, {char: "ç‹", zhuyin: "ã„¨ã„¤ËŠ"}, 
                {char: "ä¸»", zhuyin: "ã„“ã„¨Ë‡"}, {char: "åˆ", zhuyin: "ã„§ã„¡Ë‹"}
            ]},
            { title: "ç¬¬å…­èª² å°è·¯", words: [
                {char: "è·¯", zhuyin: "ã„Œã„¨Ë‹"}, {char: "é•·", zhuyin: "ã„”ã„¤ËŠ"}, 
                {char: "ç™½", zhuyin: "ã„…ã„ËŠ"}, {char: "èŠ±", zhuyin: "ã„ã„¨ã„š"}, 
                {char: "ç´…", zhuyin: "ã„ã„¨ã„¥ËŠ"}, {char: "èµ°", zhuyin: "ã„—ã„¡Ë‡"}, 
                {char: "åœ¨", zhuyin: "ã„—ã„Ë‹"}, {char: "å‘", zhuyin: "ã„’ã„§ã„¤Ë‹"}, 
                {char: "èªª", zhuyin: "ã„•ã„¨ã„›"}, {char: "æœµ", zhuyin: "ã„‰ã„¨ã„›Ë‡"}, 
                {char: "å¾", zhuyin: "ã„˜ã„¨ã„¥ËŠ"}, {char: "é ­", zhuyin: "ã„Šã„¡ËŠ"}, 
                {char: "é‚£", zhuyin: "ã„‹ã„šË‹"}
            ]}
        ];

        let currentLessonIdx = 0;
        let currentWordIdx = 0;
        let writer = null;

        function initChineseModule() {
            renderChineseSidebar();
            changeLesson(0, 0);
        }

        function getResponsiveSize() {
            const width = window.innerWidth;
            return width < 400 ? 240 : width < 600 ? 260 : 300;
        }

        function renderChineseSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.innerHTML = '<div class="sidebar-title">åº·è»’å°ä¸€èª²ç¨‹</div>';
            chineseLessons.forEach((lesson, lIndex) => {
                const groupDiv = document.createElement('div');
                const headerBtn = document.createElement('button');
                headerBtn.className = 'lesson-header';
                headerBtn.innerText = lesson.title;
                headerBtn.onclick = () => { changeLesson(lIndex, 0); };
                const gridDiv = document.createElement('div');
                gridDiv.className = 'word-grid';
                gridDiv.id = 'grid-' + lIndex;
                lesson.words.forEach((wordObj, wIndex) => {
                    const wordBtn = document.createElement('button');
                    wordBtn.className = 'sidebar-word-btn';
                    wordBtn.innerText = wordObj.char;
                    wordBtn.id = 'btn-' + lIndex + '-' + wIndex;
                    wordBtn.onclick = (e) => { e.stopPropagation(); changeLesson(lIndex, wIndex); toggleChineseMenu(); };
                    gridDiv.appendChild(wordBtn);
                });
                groupDiv.appendChild(headerBtn);
                groupDiv.appendChild(gridDiv);
                sidebar.appendChild(groupDiv);
            });
        }

        function changeLesson(lIndex, wIndex) {
            currentLessonIdx = lIndex;
            currentWordIdx = wIndex;
            updateChineseSidebarUI();
            document.getElementById('lesson-title').innerText = chineseLessons[lIndex].title;
            loadCharacter();
        }

        function updateChineseSidebarUI() {
            document.querySelectorAll('.lesson-header').forEach((btn, idx) => idx === currentLessonIdx ? btn.classList.add('active') : btn.classList.remove('active'));
            document.querySelectorAll('.word-grid').forEach((grid, idx) => idx === currentLessonIdx ? grid.classList.add('show') : grid.classList.remove('show'));
            document.querySelectorAll('.sidebar-word-btn').forEach(btn => btn.classList.remove('current'));
            const activeBtn = document.getElementById('btn-' + currentLessonIdx + '-' + currentWordIdx);
            if(activeBtn) activeBtn.classList.add('current');
        }

        function loadCharacter() {
            const lesson = chineseLessons[currentLessonIdx];
            const word = lesson.words[currentWordIdx];
            document.getElementById('progress-text').innerText = (currentWordIdx + 1) + ' / ' + lesson.words.length;
            const boxSize = getResponsiveSize();
            document.getElementById('zhuyin-box').style.height = boxSize + 'px';
            document.getElementById('character-target-div').innerHTML = '<div id="error-msg" class="error-message">è¼‰å…¥å¤±æ•—</div>';
            document.getElementById('error-msg').style.display = 'none';
            
            writer = HanziWriter.create('character-target-div', word.char, {
                width: boxSize, height: boxSize, padding: boxSize * 0.08,
                strokeColor: '#333333', radicalColor: '#e91e63',
                showOutline: true, outlineColor: '#ddd',
                strokeAnimationSpeed: 1, delayBetweenStrokes: 200,
                leniency: 2.0,
                charDataLoader: function(char, onComplete) {
                    const localUrl = './data/' + char + '.json';
                    fetch(localUrl)
                    .then(res => { if (!res.ok) throw new Error("404"); return res.json(); })
                    .then(data => onComplete(data))
                    .catch(err => {
                        fetch('https://cdn.jsdelivr.net/npm/hanzi-writer-data@2.0/' + encodeURIComponent(char) + '.json')
                            .then(res => res.json())
                        .then(data => onComplete(data))
                        .catch(err2 => onComplete(null));
                    });
                }
            });
            renderZhuyinLayout(word.zhuyin);
            updateChineseSidebarUI();
        }

        function renderZhuyinLayout(zhuyinStr) {
            const lightToneDiv = document.getElementById('tone-light');
            const symbolsDiv = document.getElementById('zhuyin-symbols');
            const sideToneDiv = document.getElementById('tone-side');
            lightToneDiv.style.visibility = 'hidden';
            sideToneDiv.style.visibility = 'hidden';
            sideToneDiv.innerHTML = '';
            let symbols = '';
            if (zhuyinStr.includes('Ë™')) {
                lightToneDiv.style.visibility = 'visible';
                symbols = zhuyinStr.replace('Ë™', '');
            } else {
                const lastChar = zhuyinStr.slice(-1);
                if (['ËŠ', 'Ë‡', 'Ë‹'].includes(lastChar)) {
                    sideToneDiv.innerHTML = lastChar;
                    sideToneDiv.style.visibility = 'visible';
                    symbols = zhuyinStr.slice(0, -1);
                } else {
                    symbols = zhuyinStr;
                }
            }
            symbolsDiv.innerHTML = symbols;
        }

        function toggleChineseMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        document.getElementById('menu-toggle').onclick = toggleChineseMenu;
        document.getElementById('overlay').onclick = toggleChineseMenu;

        function speakChinese() {
            if ('speechSynthesis' in window) {
                const word = chineseLessons[currentLessonIdx].words[currentWordIdx].char;
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'zh-TW'; utterance.rate = 0.8;
                window.speechSynthesis.speak(utterance);
            }
        }

        document.getElementById('btn-prev').onclick = () => { if(currentWordIdx > 0) changeLesson(currentLessonIdx, currentWordIdx - 1); };
        document.getElementById('btn-next').onclick = () => { 
            if(currentWordIdx < chineseLessons[currentLessonIdx].words.length - 1) changeLesson(currentLessonIdx, currentWordIdx + 1);
        };
        document.getElementById('speak-button').onclick = speakChinese;
        document.getElementById('animate-button').onclick = () => { speakChinese(); writer.cancelQuiz(); writer.animateCharacter(); };
        document.getElementById('quiz-button').onclick = () => { writer.quiz({ onComplete: () => { speakChinese(); setTimeout(() => alert('å¾ˆæ£’å–”ï¼'), 300); }}); };

        // åœ‹å­—å°æ¸¬é©—
        let chineseQuizMode = { active: false, words: [], currentIndex: 0, writer: null };

        document.getElementById('test-button').onclick = () => document.getElementById('quiz-modal').classList.add('active');
        document.getElementById('quiz-cancel-btn').onclick = () => document.getElementById('quiz-modal').classList.remove('active');
        document.getElementById('quiz-start-btn').onclick = startChineseQuiz;
        document.getElementById('quiz-exit-btn').onclick = () => { if(confirm('çµæŸæ¸¬é©—ï¼Ÿ')) endChineseQuiz(); };
        document.getElementById('success-close-btn').onclick = () => document.getElementById('quiz-success-overlay').classList.remove('active');

        function startChineseQuiz() {
            const start = parseInt(document.getElementById('quiz-start-lesson').value) - 1;
            const end = parseInt(document.getElementById('quiz-end-lesson').value) - 1;
            if (start < 0 || end >= chineseLessons.length || start > end) { alert('ç¯„åœä¸æ­£ç¢º'); return; }
            let allWords = [];
            for (let i = start; i <= end; i++) allWords = allWords.concat(chineseLessons[i].words);
            chineseQuizMode.words = allWords.sort(() => Math.random() - 0.5).slice(0, 5);
            chineseQuizMode.currentIndex = 0;
            document.getElementById('quiz-modal').classList.remove('active');
            document.getElementById('quiz-game-container').classList.add('active');
            loadChineseQuizWord();
        }

        function endChineseQuiz() {
            chineseQuizMode.active = false;
            document.getElementById('quiz-game-container').classList.remove('active');
        }

        function loadChineseQuizWord() {
            if (chineseQuizMode.currentIndex >= chineseQuizMode.words.length) {
                playSuccessSound();
                document.getElementById('success-subtext').innerHTML = 'å…¨éƒ¨ ' + chineseQuizMode.words.length + ' é¡Œéƒ½ç­”å°äº†ï¼';
                document.getElementById('quiz-success-overlay').classList.add('active');
                document.getElementById('quiz-game-container').classList.remove('active');
                return;
            }
            const word = chineseQuizMode.words[chineseQuizMode.currentIndex];
            document.getElementById('quiz-game-progress').innerText = (chineseQuizMode.currentIndex + 1) + ' / ' + chineseQuizMode.words.length;
            
            // Render zhuyin
            const lightTone = document.getElementById('quiz-tone-light');
            const symbols = document.getElementById('quiz-zhuyin-symbols');
            const sideTone = document.getElementById('quiz-tone-side');
            lightTone.innerHTML = ''; sideTone.innerHTML = '';
            let sym = '';
            if (word.zhuyin.includes('Ë™')) { lightTone.innerHTML = 'Ë™'; sym = word.zhuyin.replace('Ë™', ''); }
            else {
                const last = word.zhuyin.slice(-1);
                if (['ËŠ', 'Ë‡', 'Ë‹'].includes(last)) { sideTone.innerHTML = last; sym = word.zhuyin.slice(0, -1); }
                else sym = word.zhuyin;
            }
            symbols.innerHTML = sym;

            const boxSize = Math.min(window.innerWidth * 0.6, 250);
            document.getElementById('quiz-writer-div').innerHTML = '';
            document.getElementById('quiz-writer-div').style.width = boxSize + 'px';
            document.getElementById('quiz-writer-div').style.height = boxSize + 'px';
            
            chineseQuizMode.writer = HanziWriter.create('quiz-writer-div', word.char, {
                width: boxSize, height: boxSize, padding: boxSize * 0.08,
                showOutline: false, showCharacter: false, leniency: 2.0,
                charDataLoader: function(char, onComplete) {
                    fetch('./data/' + char + '.json').then(r => r.ok ? r.json() : Promise.reject()).then(d => onComplete(d))
                    .catch(() => fetch('https://cdn.jsdelivr.net/npm/hanzi-writer-data@2.0/' + encodeURIComponent(char) + '.json').then(r => r.json()).then(d => onComplete(d)).catch(() => onComplete(null)));
                },
                onLoadCharDataSuccess: function() {
                    setTimeout(() => {
                        chineseQuizMode.writer.quiz({
                            onComplete: () => {
                                if ('speechSynthesis' in window) {
                                    const u = new SpeechSynthesisUtterance(word.char);
                                    u.lang = 'zh-TW'; u.rate = 0.8;
                                    window.speechSynthesis.speak(u);
                                }
                                setTimeout(() => { chineseQuizMode.currentIndex++; loadChineseQuizWord(); }, 1000);
                            }
                        });
                    }, 300);
                }
            });
        }

        // ===== ESL è‹±æ–‡æ¨¡çµ„ =====
        const eslLessons = [
            { title: "Lesson 1", words: ["homework", "girl", "at school", "under the chair", "under the bed"] },
            { title: "Lesson 2", words: ["Build a house", "Under the bed", "The thin monkeys", "The dirty pigs", "girl", "Write your name", "The cute mice", "Jump", "Pencil", "Fly a kite"] },
            { title: "Lesson 3", words: ["The little kid", "The handsome man", "Hungry", "Scared", "Sick", "Smart"] },
            { title: "Lesson 4", words: ["Play video games", "At night", "Take a nap", "Take a shower", "Clean your room", "Eat fruit"] },
            { title: "Lesson 5", words: ["A lemon", "A watermelon", "A star fruit", "An apple", "A pineapple", "Some grapes", "A pear", "A peach", "Some strawberries", "A banana"] }
        ];

        let eslState = { lessonIdx: 0, wordIdx: 0 };

        function initEslModule() {
            renderEslSidebar();
            loadEslWord();
        }

        function renderEslSidebar() {
            const sidebar = document.getElementById('esl-sidebar');
            sidebar.innerHTML = '<div class="esl-sidebar-title">ESL èª²ç¨‹</div>';
            eslLessons.forEach((lesson, idx) => {
                const btn = document.createElement('button');
                btn.className = 'esl-lesson-btn' + (idx === eslState.lessonIdx ? ' active' : '');
                btn.innerText = lesson.title + ' (' + lesson.words.length + ')';
                btn.onclick = () => { eslState.lessonIdx = idx; eslState.wordIdx = 0; loadEslWord(); renderEslSidebar(); toggleEslSidebar(); };
                sidebar.appendChild(btn);
            });
        }

        function loadEslWord() {
            const lesson = eslLessons[eslState.lessonIdx];
            const word = lesson.words[eslState.wordIdx];
            document.getElementById('esl-word').innerText = word;
            document.getElementById('esl-progress').innerText = lesson.title + ' - ' + (eslState.wordIdx + 1) + '/' + lesson.words.length;
        }

        function speakEnglish() {
            if ('speechSynthesis' in window) {
                const word = eslLessons[eslState.lessonIdx].words[eslState.wordIdx];
                const u = new SpeechSynthesisUtterance(word);
                u.lang = 'en-US'; u.rate = 0.8;
                window.speechSynthesis.speak(u);
            }
        }

        function eslPrev() {
            if (eslState.wordIdx > 0) { eslState.wordIdx--; loadEslWord(); }
        }

        function eslNext() {
            const lesson = eslLessons[eslState.lessonIdx];
            if (eslState.wordIdx < lesson.words.length - 1) { eslState.wordIdx++; loadEslWord(); }
        }

        function toggleEslSidebar() {
            document.getElementById('esl-sidebar').classList.toggle('active');
            document.getElementById('esl-overlay').classList.toggle('active');
        }

        // ESL Quiz
        let eslQuiz = { words: [], currentIdx: 0, score: 0 };

        function startEslQuiz() {
            eslQuiz.words = eslLessons[eslState.lessonIdx].words.sort(() => Math.random() - 0.5).slice(0, 5);
            eslQuiz.currentIdx = 0;
            eslQuiz.score = 0;
            document.getElementById('esl-quiz-container').classList.add('active');
            loadEslQuizQuestion();
        }

        function loadEslQuizQuestion() {
            if (eslQuiz.currentIdx >= eslQuiz.words.length) {
                playSuccessSound();
                alert('æ­å–œå®Œæˆï¼ç­”å° ' + eslQuiz.score + ' / ' + eslQuiz.words.length + ' é¡Œ');
                endEslQuiz();
                return;
            }
            document.getElementById('esl-quiz-progress').innerText = (eslQuiz.currentIdx + 1) + ' / ' + eslQuiz.words.length;
            document.getElementById('esl-quiz-input').value = '';
            document.getElementById('esl-quiz-input').className = 'esl-quiz-input';
            document.getElementById('esl-quiz-feedback').innerText = '';
            speakQuizWord();
        }

        function speakQuizWord() {
            if ('speechSynthesis' in window) {
                const u = new SpeechSynthesisUtterance(eslQuiz.words[eslQuiz.currentIdx]);
                u.lang = 'en-US'; u.rate = 0.7;
                window.speechSynthesis.speak(u);
            }
        }

        function checkEslAnswer() {
            const input = document.getElementById('esl-quiz-input');
            const answer = eslQuiz.words[eslQuiz.currentIdx].toLowerCase().trim();
            const userAnswer = input.value.toLowerCase().trim();
            
            if (userAnswer === answer) {
                input.className = 'esl-quiz-input correct';
                document.getElementById('esl-quiz-feedback').innerHTML = 'âœ“ æ­£ç¢ºï¼';
                eslQuiz.score++;
                setTimeout(() => { eslQuiz.currentIdx++; loadEslQuizQuestion(); }, 1000);
            } else {
                input.className = 'esl-quiz-input wrong';
                document.getElementById('esl-quiz-feedback').innerHTML = 'âœ— ç­”æ¡ˆæ˜¯: ' + eslQuiz.words[eslQuiz.currentIdx];
                setTimeout(() => { eslQuiz.currentIdx++; loadEslQuizQuestion(); }, 2000);
            }
        }

        function endEslQuiz() {
            document.getElementById('esl-quiz-container').classList.remove('active');
        }

        document.getElementById('esl-quiz-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') checkEslAnswer(); });

        // ===== 99ä¹˜æ³•è¡¨æ¨¡çµ„ =====
        let mathState = { mode: 'table', a: 2, b: 1, score: 0, total: 0, quizQuestions: [], quizIdx: 0 };

        function initMathModule() {
            setMathMode('table');
        }

        function setMathMode(mode) {
            mathState.mode = mode;
            document.querySelectorAll('.math-mode-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            const card = document.getElementById('math-card');
            
            if (mode === 'table') {
                let html = '<div class="math-table">';
                for (let i = 1; i <= 9; i++) {
                    html += '<div class="math-table-cell header">' + i + '</div>';
                }
                for (let a = 1; a <= 9; a++) {
                    for (let b = 1; b <= 9; b++) {
                        html += '<div class="math-table-cell">' + a + 'Ã—' + b + '=' + (a*b) + '</div>';
                    }
                }
                html += '</div>';
                card.innerHTML = html;
            } else if (mode === 'practice') {
                generateMathQuestion();
                renderMathPractice();
            } else if (mode === 'quiz') {
                startMathQuiz();
            }
        }

        function generateMathQuestion() {
            mathState.a = Math.floor(Math.random() * 9) + 1;
            mathState.b = Math.floor(Math.random() * 9) + 1;
        }

        function renderMathPractice() {
            const card = document.getElementById('math-card');
            card.innerHTML = `
                <div class="math-question">${mathState.a} Ã— ${mathState.b} = ?</div>
                <input type="number" class="math-input" id="math-input" placeholder="?" min="1" max="81">
                <div class="math-feedback" id="math-feedback"></div>
                <div class="math-controls">
                    <button class="math-btn math-btn-next" onclick="checkMathAnswer()">ç¢ºèªç­”æ¡ˆ</button>
                    <button class="math-btn" style="background:#9e9e9e;color:white;" onclick="nextMathQuestion()">æ›ä¸€é¡Œ</button>
                </div>
            `;
            document.getElementById('math-input').focus();
            document.getElementById('math-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') checkMathAnswer(); });
        }

        function checkMathAnswer() {
            const input = document.getElementById('math-input');
            const correct = mathState.a * mathState.b;
            const feedback = document.getElementById('math-feedback');
            
            if (parseInt(input.value) === correct) {
                input.className = 'math-input correct';
                feedback.innerHTML = 'âœ“ æ­£ç¢ºï¼' + mathState.a + ' Ã— ' + mathState.b + ' = ' + correct;
                feedback.style.color = '#4caf50';
            } else {
                input.className = 'math-input wrong';
                feedback.innerHTML = 'âœ— ç­”æ¡ˆæ˜¯ ' + correct;
                feedback.style.color = '#f44336';
            }
        }

        function nextMathQuestion() {
            generateMathQuestion();
            renderMathPractice();
        }

        function startMathQuiz() {
            mathState.quizQuestions = [];
            mathState.quizIdx = 0;
            mathState.score = 0;
            for (let i = 0; i < 10; i++) {
                mathState.quizQuestions.push({
                    a: Math.floor(Math.random() * 9) + 1,
                    b: Math.floor(Math.random() * 9) + 1
                });
            }
            renderMathQuiz();
        }

        function renderMathQuiz() {
            if (mathState.quizIdx >= mathState.quizQuestions.length) {
                playSuccessSound();
                const card = document.getElementById('math-card');
                card.innerHTML = `
                    <div class="success-emoji">ğŸ‰</div>
                    <div class="math-question">æ¸¬é©—å®Œæˆï¼</div>
                    <div class="math-score">å¾—åˆ†: ${mathState.score} / ${mathState.quizQuestions.length}</div>
                    <button class="math-btn math-btn-next" onclick="startMathQuiz()" style="margin-top:20px;">å†æ¸¬ä¸€æ¬¡</button>
                `;
                return;
            }
            
            const q = mathState.quizQuestions[mathState.quizIdx];
            const card = document.getElementById('math-card');
            card.innerHTML = `
                <div class="math-score">ç¬¬ ${mathState.quizIdx + 1} / ${mathState.quizQuestions.length} é¡Œ</div>
                <div class="math-question">${q.a} Ã— ${q.b} = ?</div>
                <input type="number" class="math-input" id="math-quiz-input" placeholder="?" min="1" max="81">
                <div class="math-feedback" id="math-quiz-feedback"></div>
                <button class="math-btn math-btn-next" onclick="submitMathQuiz()">ç¢ºèª</button>
            `;
            document.getElementById('math-quiz-input').focus();
            document.getElementById('math-quiz-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') submitMathQuiz(); });
        }

        function submitMathQuiz() {
            const q = mathState.quizQuestions[mathState.quizIdx];
            const input = document.getElementById('math-quiz-input');
            const feedback = document.getElementById('math-quiz-feedback');
            const correct = q.a * q.b;
            
            if (parseInt(input.value) === correct) {
                input.className = 'math-input correct';
                feedback.innerHTML = 'âœ“ æ­£ç¢ºï¼';
                feedback.style.color = '#4caf50';
                mathState.score++;
            } else {
                input.className = 'math-input wrong';
                feedback.innerHTML = 'âœ— ç­”æ¡ˆæ˜¯ ' + correct;
                feedback.style.color = '#f44336';
            }
            
            setTimeout(() => { mathState.quizIdx++; renderMathQuiz(); }, 1000);
        }

        // ===== é€šç”¨å‡½æ•¸ =====
        function playSuccessSound() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const notes = [523.25, 659.25, 783.99, 1046.50];
                let t = ctx.currentTime;
                notes.forEach((f, i) => {
                    const o = ctx.createOscillator();
                    const g = ctx.createGain();
                    o.connect(g); g.connect(ctx.destination);
                    o.frequency.value = f;
                    g.gain.setValueAtTime(0.3, t);
                    g.gain.exponentialRampToValueAtTime(0.01, t + 0.15);
                    o.start(t); o.stop(t + 0.15);
                    t += 0.12;
                });
            } catch(e) {}
        }
    </script>
</body>
</html>
