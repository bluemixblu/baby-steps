<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çˆ¸çˆ¸çš„ç”Ÿå­—èª²æœ¬ V5.0</title>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        /* --- å…¨åŸŸè¨­å®š --- */
        body {
            font-family: "BiauKai", "DFKai-SB", "KaiTi", "Microsoft JhengHei", serif;
            background-color: #f4f7f6;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* --- å·¦å´é¸å–® (Sidebar) --- */
        .sidebar {
            width: 240px;
            background-color: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 20;
            transition: transform 0.3s;
        }
        
        .sidebar-title {
            padding: 20px;
            font-size: 22px;
            font-weight: bold;
            background-color: #1a252f;
            text-align: center;
            font-family: "Microsoft JhengHei", sans-serif;
            border-bottom: 1px solid #34495e;
        }

        .lesson-btn {
            padding: 15px 20px;
            border: none;
            background: none;
            color: #ecf0f1;
            text-align: left;
            font-size: 18px;
            cursor: pointer;
            border-bottom: 1px solid #34495e;
            font-family: "Microsoft JhengHei", sans-serif;
            transition: background 0.2s;
        }

        .lesson-btn:hover { background-color: #34495e; }
        .lesson-btn.active { background-color: #3498db; font-weight: bold; }

        /* --- å³å´ä¸»å…§å®¹å€ --- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            background-color: #f4f7f6;
        }

        /* èª²ç¨‹æ¨™é¡Œ */
        .current-lesson-info {
            position: absolute;
            top: 20px;
            font-size: 28px;
            color: #555;
            font-weight: bold;
            font-family: "Microsoft JhengHei", sans-serif;
            z-index: 10;
            background-color: rgba(244, 247, 246, 0.9);
            padding: 5px 20px;
            border-radius: 20px;
        }

        /* --- å·¦å³åˆ‡æ›å¤§æŒ‰éˆ• (Fixed Position) --- */
        .nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 70px;
            height: 70px;
            background-color: rgba(255, 255, 255, 0.8); /* åŠé€æ˜ç™½åº• */
            border: 2px solid #ddd;
            border-radius: 50%;
            font-size: 35px;
            color: #555;
            cursor: pointer;
            z-index: 15; /* ç¢ºä¿åœ¨å­—å¡ä¸Šé¢ */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }

        .nav-btn:hover {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
            transform: translateY(-50%) scale(1.1); /* æ»‘é¼ ç¢°åˆ°æœƒè®Šå¤§ */
        }
        
        .nav-btn:active {
            transform: translateY(-50%) scale(0.95);
        }

        /* æŒ‰éˆ•ä½ç½® */
        .prev-btn { left: 20px; }
        .next-btn { right: 20px; }


        /* --- å­—å¡å®¹å™¨ --- */
        .card-container {
            background-color: #ffffff;
            padding: 30px 50px;
            border-radius: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            /* ç§»é™¤ relativeï¼Œå› ç‚ºæŒ‰éˆ•ç¾åœ¨æ˜¯è·Ÿè‘—è¢å¹•å®šä½ */
        }

        /* æ ¸å¿ƒé¡¯ç¤ºå€ï¼šåœ‹å­— + æ³¨éŸ³ */
        .character-wrapper {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            gap: 20px;
        }

        /* åœ‹å­—æ¡† (ç”°å­—æ ¼) */
        #character-target-div {
            width: 320px;
            height: 320px;
            border: 4px solid #333;
            background-color: #fffadd;
            border-radius: 8px;
            position: relative;
        }
        /* ç”°å­—æ ¼ç´…ç·š */
        #character-target-div::before {
            content: ""; position: absolute; top: 50%; left: 0; width: 100%; height: 1px;
            background-color: #d47e7e; pointer-events: none;
        }
        #character-target-div::after {
            content: ""; position: absolute; left: 50%; top: 0; height: 100%; width: 1px;
            background-color: #d47e7e; pointer-events: none;
        }

        /* æ³¨éŸ³ç³»çµ± */
        .zhuyin-system {
            height: 320px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #333;
        }
        .zhuyin-light-tone { font-size: 40px; height: 40px; line-height: 40px; margin-bottom: -10px; visibility: hidden; }
        .zhuyin-body-row { display: flex; flex-direction: row; align-items: center; height: 100%; }
        .zhuyin-symbols { font-size: 55px; writing-mode: vertical-rl; text-orientation: upright; letter-spacing: 15px; }
        .zhuyin-side-tone { font-size: 45px; width: 35px; display: flex; justify-content: center; visibility: hidden; margin-left: 5px; }

        /* ä¸‹æ–¹æ§åˆ¶æŒ‰éˆ• */
        .controls { display: flex; gap: 20px; margin-top: 20px;}
        .btn {
            padding: 12px 25px; font-size: 22px; border: none; border-radius: 50px;
            cursor: pointer; font-family: "Microsoft JhengHei", sans-serif; font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.95); }
        .btn-speak { background-color: #FFB74D; color: white; }
        .btn-animate { background-color: #4FC3F7; color: white; }
        .btn-quiz { background-color: #66BB6A; color: white; }
        
        .progress-indicator { margin-top: 15px; font-size: 16px; color: #999; font-family: sans-serif; }

        /* æ‰‹æ©Ÿç›´å‘æ™‚éš±è— Sidebar çš„ç°¡å–® RWD (é¸ç”¨) */
        @media (max-width: 768px) {
            .sidebar { display: none; } /* æ‰‹æ©Ÿç‰ˆæš«æ™‚éš±è—ç›®éŒ„ï¼Œå°ˆæ³¨é¡¯ç¤ºå­—å¡ */
            .prev-btn { left: 10px; width: 50px; height: 50px; font-size: 25px; }
            .next-btn { right: 10px; width: 50px; height: 50px; font-size: 25px; }
        }
    </style>
</head>
<body>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-title">ç”Ÿå­—èª²æœ¬</div>
    </div>

    <div class="main-content" id="main-area">
        <div class="current-lesson-info" id="lesson-title">ç¬¬ä¸€èª²ï¼šæ‹æ‹æ‰‹</div>

        <button class="nav-btn prev-btn" id="btn-prev" title="ä¸Šä¸€å€‹å­—">â®</button>
        <button class="nav-btn next-btn" id="btn-next" title="ä¸‹ä¸€å€‹å­—">â¯</button>
        
        <div class="card-container">
            <div class="character-wrapper">
                <div id="character-target-div"></div>
                <div class="zhuyin-system">
                    <div class="zhuyin-light-tone" id="tone-light">Ë™</div>
                    <div class="zhuyin-body-row">
                        <div class="zhuyin-symbols" id="zhuyin-symbols"></div>
                        <div class="zhuyin-side-tone" id="tone-side"></div>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button id="speak-button" class="btn btn-speak">ğŸ”Š å”¸å”¸çœ‹</button>
                <button id="animate-button" class="btn btn-animate">â–¶ï¸ ç­†é †</button>
                <button id="quiz-button" class="btn btn-quiz">ğŸ‘† å¯«å¯«çœ‹</button>
            </div>
            
            <div class="progress-indicator" id="progress-text">1 / 10</div>
        </div>
    </div>

    <script>
        // --- å®Œæ•´è³‡æ–™åº« ---
        const lessons = [
            {
                title: "ç¬¬ä¸€èª² æ‹æ‹æ‰‹",
                words: [
                    {char: "æ‹", zhuyin: "ã„†ã„"}, {char: "æ‰‹", zhuyin: "ã„•ã„¡Ë‡"}, {char: "å·¦", zhuyin: "ã„—ã„¨ã„›Ë‡"},
                    {char: "å³", zhuyin: "ã„§ã„¡Ë‹"}, {char: "ä½ ", zhuyin: "ã„‹ã„§Ë‡"}, {char: "ä»–", zhuyin: "ã„Šã„š"},
                    {char: "ä¹Ÿ", zhuyin: "ã„§ã„Ë‡"}, {char: "ä¸Š", zhuyin: "ã„•ã„¤Ë‹"}, {char: "ä¸‹", zhuyin: "ã„’ã„§ã„šË‹"}
                ]
            },
            {
                title: "ç¬¬äºŒèª² é€™æ˜¯èª°çš„?",
                words: [
                    {char: "é€™", zhuyin: "ã„“ã„œË‹"}, {char: "æ˜¯", zhuyin: "ã„•Ë‹"}, {char: "èª°", zhuyin: "ã„•ã„ŸËŠ"},
                    {char: "çš„", zhuyin: "Ë™ã„‰ã„œ"}, {char: "æˆ‘", zhuyin: "ã„¨ã„›Ë‡"}, {char: "åˆ†", zhuyin: "ã„ˆã„£"},
                    {char: "å¥½", zhuyin: "ã„ã„ Ë‡"}, {char: "äº†", zhuyin: "Ë™ã„Œã„œ"}, {char: "å•Š", zhuyin: "Ë™ã„š"},
                    {char: "å¤š", zhuyin: "ã„‰ã„¨ã„›"}, {char: "å€‹", zhuyin: "Ë™ã„ã„œ"} 
                ]
            },
            {
                title: "ç¬¬ä¸‰èª² ç§‹åƒ",
                words: [
                    {char: "ç§‹", zhuyin: "ã„‘ã„§ã„¡"}, {char: "åƒ", zhuyin: "ã„‘ã„§ã„¢"}, {char: "å’Œ", zhuyin: "ã„ã„¢Ë‹"},
                    {char: "ç©", zhuyin: "ã„¨ã„¢ËŠ"}, {char: "é™ª", zhuyin: "ã„†ã„ŸËŠ"}, {char: "é«˜", zhuyin: "ã„ã„ "},
                    {char: "å±±", zhuyin: "ã„•ã„¢"}, {char: "åˆ°", zhuyin: "ã„‰ã„ Ë‹"}, {char: "å¤§", zhuyin: "ã„‰ã„šË‹"},
                    {char: "æµ·", zhuyin: "ã„ã„Ë‡"}, {char: "æœ‹", zhuyin: "ã„†ã„¥ËŠ"}, {char: "å‹", zhuyin: "ã„§ã„¡Ë‡"},
                    {char: "å€‘", zhuyin: "Ë™ã„‡ã„£"}, {char: "èµ·", zhuyin: "ã„‘ã„§Ë‡"}
                ]
            },
            {
                title: "ç¬¬å››èª² å¤§å€‹å­ï¼Œå°å€‹å­",
                words: [
                    {char: "å­", zhuyin: "Ë™ã„—"}, {char: "å°", zhuyin: "ã„’ã„§ã„ Ë‡"}, {char: "èª²", zhuyin: "ã„ã„œË‹"},
                    {char: "å…©", zhuyin: "ã„Œã„§ã„¤Ë‡"}, {char: "äºº", zhuyin: "ã„–ã„£ËŠ"}, {char: "æ‹‰", zhuyin: "ã„Œã„š"},
                    {char: "çœ‹", zhuyin: "ã„ã„¢Ë‹"}, {char: "æ‰¾", zhuyin: "ã„“ã„ Ë‡"}, {char: "éš»", zhuyin: "ã„“"},
                    {char: "é’", zhuyin: "ã„‘ã„§ã„¥"}, {char: "è›™", zhuyin: "ã„¨ã„š"}, {char: "é–‹", zhuyin: "ã„ã„"},
                    {char: "å¿ƒ", zhuyin: "ã„’ã„§ã„£"}
                ]
            },
            {
                title: "ç¬¬äº”èª² æ¯”ä¸€æ¯”",
                words: [
                    {char: "æ¯”", zhuyin: "ã„…ã„§Ë‡"}, {char: "é–€", zhuyin: "ã„‡ã„£ËŠ"}, {char: "è£¡", zhuyin: "ã„Œã„§Ë‡"},
                    {char: "å¤–", zhuyin: "ã„¨ã„Ë‹"}, {char: "æœ‰", zhuyin: "ã„§ã„¡Ë‡"}, {char: "ä»€", zhuyin: "ã„•ã„œËŠ"},
                    {char: "éº¼", zhuyin: "Ë™ã„‡ã„œ"}, {char: "ä¸", zhuyin: "ã„…ã„¨Ë‹"}, {char: "åŒ", zhuyin: "ã„Šã„¨ã„¥ËŠ"},
                    {char: "æ—©", zhuyin: "ã„—ã„ Ë‡"}, {char: "æ™š", zhuyin: "ã„¨ã„¢Ë‡"}, {char: "ç‹", zhuyin: "ã„¨ã„¤ËŠ"},
                    {char: "ä¸»", zhuyin: "ã„“ã„¨Ë‡"}, {char: "åˆ", zhuyin: "ã„§ã„¡Ë‹"}
                ]
            },
            {
                title: "ç¬¬å…­èª² å°è·¯",
                words: [
                    {char: "è·¯", zhuyin: "ã„Œã„¨Ë‹"}, {char: "é•·", zhuyin: "ã„”ã„¤ËŠ"}, {char: "ç™½", zhuyin: "ã„…ã„ËŠ"},
                    {char: "èŠ±", zhuyin: "ã„ã„¨ã„š"}, {char: "ç´…", zhuyin: "ã„ã„¨ã„¥ËŠ"}, {char: "èµ°", zhuyin: "ã„—ã„¡Ë‡"},
                    {char: "åœ¨", zhuyin: "ã„—ã„Ë‹"}, {char: "å‘", zhuyin: "ã„’ã„§ã„¤Ë‹"}, {char: "èªª", zhuyin: "ã„•ã„¨ã„›"},
                    {char: "æœµ", zhuyin: "ã„‰ã„¨ã„›Ë‡"}, {char: "å¾", zhuyin: "ã„˜ã„¨ã„¥ËŠ"}, {char: "é ­", zhuyin: "ã„Šã„¡ËŠ"},
                    {char: "é‚£", zhuyin: "ã„‹ã„šË‹"}
                ]
            }
        ];

        // --- å…¨åŸŸè®Šæ•¸ ---
        let currentLessonIdx = 0;
        let currentWordIdx = 0;
        let writer = null;

        // --- ä»‹é¢æ¸²æŸ“ ---
        function renderSidebar() {
            const sidebar = document.getElementById('sidebar');
            lessons.forEach((lesson, index) => {
                const btn = document.createElement('button');
                btn.className = 'lesson-btn';
                if(index === 0) btn.classList.add('active');
                btn.innerText = lesson.title;
                btn.onclick = () => changeLesson(index);
                sidebar.appendChild(btn);
            });
        }

        function changeLesson(index) {
            currentLessonIdx = index;
            currentWordIdx = 0;
            const btns = document.querySelectorAll('.lesson-btn');
            btns.forEach(b => b.classList.remove('active'));
            btns[index].classList.add('active');
            document.getElementById('lesson-title').innerText = lessons[index].title;
            loadCharacter();
        }

        function loadCharacter() {
            const lesson = lessons[currentLessonIdx];
            const word = lesson.words[currentWordIdx];
            document.getElementById('progress-text').innerText = `${currentWordIdx + 1} / ${lesson.words.length}`;

            // é‡å»º HanziWriter
            document.getElementById('character-target-div').innerHTML = '';
            writer = HanziWriter.create('character-target-div', word.char, {
                width: 320, height: 320, padding: 25,
                strokeColor: '#333333', radicalColor: '#e91e63',
                showOutline: true, outlineColor: '#ddd',
                strokeAnimationSpeed: 1, delayBetweenStrokes: 200,
                highlightOnVariation: true, drawingWidth: 35,
            });

            renderZhuyinLayout(word.zhuyin);
        }

        // æ³¨éŸ³æ’ç‰ˆ V3
        function renderZhuyinLayout(zhuyinStr) {
            const lightToneDiv = document.getElementById('tone-light');
            const symbolsDiv = document.getElementById('zhuyin-symbols');
            const sideToneDiv = document.getElementById('tone-side');

            lightToneDiv.style.visibility = 'hidden';
            sideToneDiv.style.visibility = 'hidden';
            sideToneDiv.innerHTML = '';
            let symbols = '';
            
            if (zhuyinStr.includes('Ë™')) {
                lightToneDiv.style.visibility = 'visible';
                symbols = zhuyinStr.replace('Ë™', '');
            } else {
                const lastChar = zhuyinStr.slice(-1);
                if (['ËŠ', 'Ë‡', 'Ë‹'].includes(lastChar)) {
                    sideToneDiv.innerHTML = lastChar;
                    sideToneDiv.style.visibility = 'visible';
                    symbols = zhuyinStr.slice(0, -1);
                } else {
                    symbols = zhuyinStr;
                }
            }
            symbolsDiv.innerHTML = symbols;
        }

        // --- äº’å‹•åŠŸèƒ½ ---
        function speakWord() {
            if ('speechSynthesis' in window) {
                const word = lessons[currentLessonIdx].words[currentWordIdx].char;
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'zh-TW'; utterance.rate = 0.8;
                window.speechSynthesis.speak(utterance);
            }
        }

        function prevChar() {
            if (currentWordIdx > 0) {
                currentWordIdx--;
                loadCharacter();
            }
        }

        function nextChar() {
            const lesson = lessons[currentLessonIdx];
            if (currentWordIdx < lesson.words.length - 1) {
                currentWordIdx++;
                loadCharacter();
            } else {
                if(currentLessonIdx < lessons.length - 1) {
                    if(confirm("é€™èª²çµæŸäº†ï¼Œè¦é€²å…¥ä¸‹ä¸€èª²å—ï¼Ÿ")) changeLesson(currentLessonIdx + 1);
                } else {
                    alert("å¤ªæ£’äº†ï¼å…¨éƒ¨å­¸å®Œäº†ï¼");
                }
            }
        }

        // --- äº‹ä»¶ç¶å®š ---
        document.getElementById('btn-prev').addEventListener('click', prevChar);
        document.getElementById('btn-next').addEventListener('click', nextChar);
        document.getElementById('speak-button').addEventListener('click', speakWord);
        
        document.getElementById('animate-button').addEventListener('click', function() {
            speakWord();
            writer.cancelQuiz();
            writer.animateCharacter();
        });

        document.getElementById('quiz-button').addEventListener('click', function() {
            writer.quiz({
                onComplete: function() {
                    speakWord();
                    setTimeout(() => alert('å¥½æ£’ï¼å¯«å®Œäº†ï¼ğŸ‰'), 300);
                }
            });
        });

        // éµç›¤å·¦å³éµ
        document.addEventListener('keydown', function(e) {
            if(e.key === "ArrowLeft") prevChar();
            if(e.key === "ArrowRight") nextChar();
        });

        // è§¸æ§æ»‘å‹• (Swipe)
        let touchStartX = 0;
        let touchEndX = 0;
        const mainArea = document.getElementById('main-area');
        
        mainArea.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; }, {passive: true});
        mainArea.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            if (touchEndX < touchStartX - 50) nextChar();
            if (touchEndX > touchStartX + 50) prevChar();
        }, {passive: true});

        // åˆå§‹åŒ–
        window.onload = function() {
            renderSidebar();
            loadCharacter();
        };

    </script>
</body>
</html>